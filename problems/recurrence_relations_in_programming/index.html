<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Pragmatic Recurrence Relations: Why the Closed Form Won't Help You &#183; Barnaby's Blog</title>
<meta name=title content="Pragmatic Recurrence Relations: Why the Closed Form Won't Help You &#183; Barnaby's Blog"><meta name=description content="An explanation of why using the closed form solution in recurrence relation programming problems often isn't useful, with an example problem"><meta name=keywords content="Maths,Recurrence Relation,"><link rel=canonical href=https://barnabywreford.co.uk/problems/recurrence_relations_in_programming/><link type=text/css rel=stylesheet href=/css/main.bundle.min.4ed2220b06454610a8a494fc6a9246b704e91bf845506e882a226f03c88b69098edc150c8f38844da43e356b1c3891161cd1b0ca131847ee658578ce4983ac59.css integrity="sha512-TtIiCwZFRhCopJT8apJGtwTpG/hFUG6IKiJvA8iLaQmO3BUMjziETaQ+NWscOJEWHNGwyhMYR+5lhXjOSYOsWQ=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.3fc65be8df47ebc01260b43d7620a42d41769de3b3933d9263b4ec813e87828f9a851f1127ffff8ec45a65cd326726cf1f1ac529f341039c65f3f887e8fd6051.js integrity="sha512-P8Zb6N9H68ASYLQ9diCkLUF2neOzkz2SY7TsgT6Hgo+ahR8RJ///jsRaZc0yZybPHxrFKfNBA5xl8/iH6P1gUQ==" data-copy data-copied></script><script src=/lib/zoom/zoom.min.37d2094687372da3f7343a221a470f6b8806f7891aa46a5a03966af7f0ebd38b9fe536cb154e6ad28f006d184b294525a7c4054b6bbb4be62d8b453b42db99bd.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ=="></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Pragmatic Recurrence Relations: Why the Closed Form Won't Help You"><meta property="og:description" content="An explanation of why using the closed form solution in recurrence relation programming problems often isn't useful, with an example problem"><meta property="og:type" content="article"><meta property="og:url" content="https://barnabywreford.co.uk/problems/recurrence_relations_in_programming/"><meta property="og:image" content="https://barnabywreford.co.uk/problems/recurrence_relations_in_programming/feature.png"><meta property="article:section" content="problems"><meta property="article:published_time" content="2025-01-30T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-30T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://barnabywreford.co.uk/problems/recurrence_relations_in_programming/feature.png"><meta name=twitter:title content="Pragmatic Recurrence Relations: Why the Closed Form Won't Help You"><meta name=twitter:description content="An explanation of why using the closed form solution in recurrence relation programming problems often isn't useful, with an example problem"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Problems","name":"Pragmatic Recurrence Relations: Why the Closed Form Won\u0027t Help You","headline":"Pragmatic Recurrence Relations: Why the Closed Form Won\u0027t Help You","description":"An explanation of why using the closed form solution in recurrence relation programming problems often isn\u0027t useful, with an example problem","abstract":"The Lesson # It\u0026rsquo;s easy to get hooked on the idea of performance and optimisation, but when it comes to recurrence relation problems in programming, it\u0026rsquo;s easy to fall into the trap of chasing the perfect solution.","inLanguage":"en","url":"https:\/\/barnabywreford.co.uk\/problems\/recurrence_relations_in_programming\/","author":{"@type":"Person","name":"Barnaby Wreford"},"copyrightYear":"2025","dateCreated":"2025-01-30T00:00:00\u002b00:00","datePublished":"2025-01-30T00:00:00\u002b00:00","dateModified":"2025-01-30T00:00:00\u002b00:00","keywords":["Maths","Recurrence Relation"],"mainEntityOfPage":"true","wordCount":"1887"}]</script><meta name=author content="Barnaby Wreford"><link href=mailto:bwreford.contact@gmail.com rel=me><link href=https://github.com/barnaby-wreford rel=me><link href=https://www.linkedin.com/in/barnaby-wreford-8a9241318 rel=me><script src=/lib/jquery/jquery.slim.min.b0dca576e87d7eaa5850ae4e61759c065786cdb6489d68fcc82240539eebd5da522bdb4fda085ffd245808c8fe2acb2516408eb774ef26b5f6015fc6737c0ea8.js integrity="sha512-sNylduh9fqpYUK5OYXWcBleGzbZInWj8yCJAU57r1dpSK9tP2ghf/SRYCMj+KsslFkCOt3TvJrX2AV/Gc3wOqA=="></script><link type=text/css rel=stylesheet href=/lib/katex/katex.min.e9afe31fe3937d5e7a56cf4c9be2a5ed9b1758944cdbe115f890eb5bb1cb1da7f8394dbef5e2e41ca15bce94926df2796fad26fbbfed4007afaf3bbb34fed0da.css integrity="sha512-6a/jH+OTfV56Vs9Mm+Kl7ZsXWJRM2+EV+JDrW7HLHaf4OU2+9eLkHKFbzpSSbfJ5b60m+7/tQAevrzu7NP7Q2g=="><script defer src=/lib/katex/katex.min.1649a56c18808fc7e07e867ccc9f9b650094e69754e798ab5e6273145fe65e54af06bdb1fe09b22c7691bb9892a5c0391f0e8230b0821528c1d469a0b4d2f642.js integrity="sha512-FkmlbBiAj8fgfoZ8zJ+bZQCU5pdU55irXmJzFF/mXlSvBr2x/gmyLHaRu5iSpcA5Hw6CMLCCFSjB1GmgtNL2Qg=="></script><script defer src=/lib/katex/auto-render.min.e9b2833d28623d18c071d78ef13e9c79d695122d296af3dbcee7bf1bf6518b0565bab59939267fbc8f5faf696193c20f5caef3e7501969cfb306f6738032730d.js integrity="sha512-6bKDPShiPRjAcdeO8T6cedaVEi0pavPbzue/G/ZRiwVlurWZOSZ/vI9fr2lhk8IPXK7z51AZac+zBvZzgDJzDQ==" onload=renderMathInElement(document.body)></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-YVTB4ZDJ50"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YVTB4ZDJ50")</script><meta name=theme-color></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px]" style=z-index:100><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start gap-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">Barnaby&rsquo;s Blog</a></nav><nav class="hidden md:flex items-center gap-x-5 md:ml-12 h-12"><a href=/problems/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title=Problems>Problems</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center gap-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-1 rtl:ml-1"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 md:hidden"><label id=menu-button class=block><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li id=menu-close-button><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/problems/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title=Problems>Problems</p></a></li></ul></div></label></div></div></div></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("menu-blur");n.style.opacity=t/300})</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><figure><img class="w-full rounded-lg single_hero_round nozoom" alt="Pragmatic Recurrence Relations: Why the Closed Form Won't Help You" width=1200 height=646 src=/problems/recurrence_relations_in_programming/feature_hu26f2021367d80d960e606a5b51f57355_449456_1200x0_resize_box_3.png></figure><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Pragmatic Recurrence Relations: Why the Closed Form Won't Help You</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-01-30T00:00:00+00:00>30 January 2025</time><span class="px-2 text-primary-500">&#183;</span><span>1887 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">9 mins</span></div></div><div class="flex author"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Barnaby Wreford" src=/profile_hu68471ce5249335158e00a42614510882_266732_192x192_fill_box_center_3.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Barnaby Wreford</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:bwreford.contact@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/barnaby-wreford target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/barnaby-wreford-8a9241318 target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-lesson>The Lesson</a></li><li><a href=#a-failed-attempt-at-getting-mathematical>A Failed Attempt at getting Mathematical</a><ul><li><a href=#mathematical-solution>Mathematical Solution</a><ul><li><a href=#calculating-fn>Calculating F(n)</a></li><li><a href=#calculating-vn>Calculating v(n)</a></li><li><a href=#final-formula>Final formula</a></li></ul></li><li><a href=#implementing-the-solution>Implementing the solution</a><ul><li><a href=#modular-exponentiation>modular exponentiation</a></li><li><a href=#mixed-approach-with-matrices>mixed approach with matrices</a></li><li><a href=#no-modular-tricks>No modular tricks</a></li></ul></li><li><a href=#analysing-my-solution>Analysing my solution</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-lesson>The Lesson</a></li><li><a href=#a-failed-attempt-at-getting-mathematical>A Failed Attempt at getting Mathematical</a><ul><li><a href=#mathematical-solution>Mathematical Solution</a><ul><li><a href=#calculating-fn>Calculating F(n)</a></li><li><a href=#calculating-vn>Calculating v(n)</a></li><li><a href=#final-formula>Final formula</a></li></ul></li><li><a href=#implementing-the-solution>Implementing the solution</a><ul><li><a href=#modular-exponentiation>modular exponentiation</a></li><li><a href=#mixed-approach-with-matrices>mixed approach with matrices</a></li><li><a href=#no-modular-tricks>No modular tricks</a></li></ul></li><li><a href=#analysing-my-solution>Analysing my solution</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details><script>var margin=200,marginError=50;(function(){var t=$(window),e=$("#TOCView"),s=e.height();function n(){var n=t.height()-margin;s>=n?(e.css("overflow-y","scroll"),e.css("max-height",n+marginError+"px")):(e.css("overflow-y","hidden"),e.css("max-height","9999999px"))}t.on("resize",n),$(document).ready(n)})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h2 class="relative group">The Lesson<div id=the-lesson class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-lesson aria-label=Anchor>#</a></span></h2><p>It&rsquo;s easy to get hooked on the idea of performance and optimisation, but
when it comes to recurrence relation problems in programming, it&rsquo;s easy to fall into the
trap of chasing the perfect solution. You&rsquo;ve done your homework, read up
on all the maths, and now you&rsquo;re ready to blast the next recurrence relation
problem you see with algebra, find and utilise the closed form solution, and leave other&rsquo;s
code in the dust.</p><p>There&rsquo;s only one problem: most of the time, it doesn&rsquo;t work.</p><p>For starters, existing general purpose solutions like matrix exponentiation already work well:
it&rsquo;s simple to implement, applies to many recurrence problems and finds solutions in
logarithmic time, and while I hate to admit it, in most situations that is
fast enough.</p><p>Indeed, most of the time you would actually care about improving speed
beyond logarithmic time is when the inputs are really large, but this
means that you are almost certainly taking the modulus of the answer,
at least in any programming challenge, because most recurrence relations
grow fast.</p><p>Take for example the fibonacci sequence, the million&rsquo;th term in the sequence
has over 200,000 digits. These large numbers are awkward to deal with, so programming
challenges ask for answers to be given to a modulus.</p><p>This use of modular arithmetic makes implementing closed form solutions
much harder, because this solution will often involve real numbers instead
of just integers, and the normal rules of modular arithmetic do not apply
when using real numbers. You will see later in the problem I tried just how
pesky these real numbers can be.</p><p>However, there may still be those out there who would be undeterred by these
barriers, who want to push on for greater performance even when it might
not seem strictly necessary. Unfortunately, the real killer to the fervent
optimser&rsquo;s dream is the real-world performance of these solutions: often they
actually perform worse than easier methods like matrix exponentiation.</p><p>This is partially because at the end of the day you&rsquo;re doing exponentiation,
either with scalars in the closed form or with matrices, meaning the extent
to which you can improve the overall time complexity is limited. However, what can
actually make the recurrent solution slower is the requirement for the real
numbers in the closed form solution to be extremely accurate for large inputs,
meaning finding and using these numbers can be extremely computationally expensive.</p><p>You will now see how I tried to solve a fairly standard recurrence relation problem
using a more mathematical approach than is traditional, and how it failed.</p><h2 class="relative group">A Failed Attempt at getting Mathematical<div id=a-failed-attempt-at-getting-mathematical class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#a-failed-attempt-at-getting-mathematical aria-label=Anchor>#</a></span></h2><p>The problem is one I have tackled before: <a href=/problems/leetcode_552/>Leetcode Problem 552</a>.
If you want more information about the problem and the solution using matrix exponentiation then please go read that article;
the crux of the problem, if we want to use recurrence relations, is finding the following:
$$
v(n) = \sum_{i=0}^{n-1} F(i)F(n-i-1)
$$
where \(F(n)\) is a Tribonacci number:
$$
F(n)=F(n-1)+F(n-2)+F(n-3)
$$</p><h3 class="relative group">Mathematical Solution<div id=mathematical-solution class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#mathematical-solution aria-label=Anchor>#</a></span></h3><h4 class="relative group">Calculating F(n)<div id=calculating-fn class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#calculating-fn aria-label=Anchor>#</a></span></h4><p>First, I found the roots of the characteristic equation:
$$
x^3-x^2-x-1=0
$$</p><p>I then used sympy to find the roots and coefficients of the closed form solution:
$$
F(n) = A r_1^n + B r_2^n + C r_3^n
$$</p><p>Here are the numerical approximations to these values:</p><ul><li>\(A \approx 1.137 \)</li><li>\(r_1 \approx 1.839 \)</li><li>\(B \approx -0.0687 + 0.124 i \)</li><li>\(r_2 \approx -0.420 + 0.606 i\)</li><li>\(C \approx -0.0687 - 0.124 i\)</li><li>\(r_3 \approx -0.420 - 0.606 i\)</li></ul><p>The exact roots and coefficients are complicated, but what is important about these values are:</p><ul><li>they aren&rsquo;t rational</li><li>two of the terms in our function are complex</li><li>the two complex terms are very small and get smaller as n grows</li><li>when combined they make an integer (since \(F(n)\) is an integer)</li></ul><p>The small size of the two complex terms are very helpful, because they are small enough
that we can simply ignore them and round the first term:
$$
F(n) \approx A r_1^n
$$</p><h4 class="relative group">Calculating v(n)<div id=calculating-vn class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#calculating-vn aria-label=Anchor>#</a></span></h4><p>Remember we have the following formula for \(v(n)\):
$$
v(n) = \sum_{i=0}^{n-1} F(i)F(n-i-1)
$$</p><p>If we now sub in our formula for \(F(n)\)</p><p>$$
v(n) = \sum_{i=0}^{n-1} (Ar_1^i+Br_2^i+Cr_3^i)(Ar_1^{n-i-1}+Br_2^{n-i-1}+Cr_3^{n-i-1})
$$</p><p>We only need to consider terms involving \(Ar_1^n\) in our approximation:
$$
v(n) \approx \sum_{i=0}^{n-1} A^2r_1^{n-1} + Ar_1^i(Br_2^{n-i-1}+Cr_3^{n-i-1}) + Ar_1^{n-i-1}(Br_2^i+Cr_3^i)
$$</p><p>The sum of terms 2 and 3 are the same:
$$
v(n) \approx \sum_{i=0}^{n-1} A^2r_1^{n-1} + 2Ar_1^i(Br_2^{n-i-1} + Cr_3^{n-i-1})
$$</p><p>We can use the following formula to help us evaluate the 2nd term:
$$
\sum_{i=0}^n a^i b^{n-i} = \frac{b^{n+1}-a^{n+1}}{b-a}
$$</p><p>In this case, due to the size of the complex terms growing insignificant when raised to the power of n,
we can ignore the \(a^{n+1}\) part for those terms:
$$
v(n) \approx nA^2r_1^{n-1} + 2A(B \frac{r_1^n}{r_1-r_2} + C \frac{r_1^n}{r_1-r_3})
$$</p><p>We are only interested in the real part of the sum, and we know that the answer we are approximating
is real, so we can safely remove the imaginary part (it would have been cancelled out by the other complex terms
if we hadn&rsquo;t ignored them). The real part is the same for both terms in the brackets, so
we can just take the real part of one and multiply by two:
$$
v(n) \approx nA^2r_1^{n-1} + 4Ar_1^n \cdot \Re(\frac{B}{r_1-r_2})
$$</p><h4 class="relative group">Final formula<div id=final-formula class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#final-formula aria-label=Anchor>#</a></span></h4><p>The actual solution requires adding \(F(n)\) to \(v(n)\) and taking the modulus:
$$
\text{solution} = \text{round}(Ar_1^{n-1}[nA+4r_1 \cdot \Re(\frac{B}{r_1-r_2})+r_1]) \mod m
$$</p><p>This formula looks a little complicated, but there are only two parts of the formula that involve n.
Therefore we can simply the formula to:
$$
\text{solution} = \text{round}(r_1^{n-1}[A^2 n + c]) \mod m
$$</p><p>Note that while the &lsquo;round&rsquo; function may look a little messy, it only accounts for the complex
terms in the closed form solution that we ignored, which get very small quickly, so even without the round function
the answer would be very close, especially for larger n.</p><h3 class="relative group">Implementing the solution<div id=implementing-the-solution class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implementing-the-solution aria-label=Anchor>#</a></span></h3><p>This is the point where maths meets reality. At this point a mathematician would have sat back
and enjoyed their formula that gives the answer for any n neatly.</p><p>However, this is very difficult to implement in a program due to the fact that \(r_1\)
is a real number, and so are the other terms \(A^2 n + c\), which stops us from being able to do any useful modular
arithmetic tricks.</p><p>Let&rsquo;s explore some of the ideas I tried to use modular arithmetic to get a fast solution.</p><h4 class="relative group">modular exponentiation<div id=modular-exponentiation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#modular-exponentiation aria-label=Anchor>#</a></span></h4><p>Normally, you would see \(r^n \mod m\) and think of using the multiplicative order
of r:
$$
r^k = 1 \mod m
$$
$$
r^n = r^{n \ \% \ k} \mod m
$$</p><p>Unfortunately, this does not hold when using real numbers. For example:</p><ul><li>let \(k = \log_{1.8}(8)\)</li><li>so \(1.8^k = 1 \mod 7\)</li><li>\(1.8^{10} \approx 0.05 \mod 7 \)</li><li>\(1.8^{10 \ \% \ k} \approx 5.8 \mod 7\)</li></ul><h4 class="relative group">mixed approach with matrices<div id=mixed-approach-with-matrices class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#mixed-approach-with-matrices aria-label=Anchor>#</a></span></h4><p>OK, so at this point I thought fine, if I can&rsquo;t find \(r_1^{n-1} % m\) using my closed
form solution, I can just find the related value \(F(n-1)\) using matrix exponentiation, and then multiply
by \(A^2 n + c\).</p><p>This should still be faster than finding the answer directly with matrix exponentiation since
to find the solution directly using that technique requires a 7x7 matrix (in my solution), while to just find
\(F(n)\) only requires a 3x3 matrix. Since matrix multiplication is \(O(n^3)\), this should
result in roughly a 12x speed increase.</p><p>Unfortunately, once again the rules of modular arithmetic thwart us. In particular, while the
following property holds for integers, it is not true for real numbers:
$$
ab \mod m \ne ((a \mod m) \cdot (b \mod m)) \mod m
$$</p><p>This means that even if we use matrix exponentiation to calculate \( r_1^{n-1}\) mod m,
we cannot multiply it by our constant to get the answer mod m.</p><h4 class="relative group">No modular tricks<div id=no-modular-tricks class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#no-modular-tricks aria-label=Anchor>#</a></span></h4><p>So we can&rsquo;t use any modular tricks, so what? We can still use our formula to calculate the
final value and then just mod that.</p><p>This approach works and can be easily implemented:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>solve_with_recurrence</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>A</span><span class=p>,</span> <span class=n>B</span><span class=p>,</span> <span class=n>r1</span><span class=p>,</span> <span class=n>r2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>n</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>n</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>A</span><span class=o>*</span><span class=p>(</span><span class=mi>4</span><span class=o>*</span><span class=n>r1</span><span class=o>*</span><span class=n>sympy</span><span class=o>.</span><span class=n>re</span><span class=p>(</span><span class=n>B</span><span class=o>/</span><span class=p>(</span><span class=n>r1</span><span class=o>-</span><span class=n>r2</span><span class=p>))</span> <span class=o>+</span> <span class=n>r1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>round</span><span class=p>(</span><span class=n>r1</span><span class=o>**</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>A</span><span class=o>*</span><span class=n>A</span><span class=o>*</span><span class=n>n</span><span class=o>+</span><span class=n>c</span><span class=p>))</span> <span class=o>%</span> <span class=mi>1000000007</span>
</span></span></code></pre></div><h3 class="relative group">Analysing my solution<div id=analysing-my-solution class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#analysing-my-solution aria-label=Anchor>#</a></span></h3><p>However, what&rsquo;s being hidden in the previous code snippet is the calculation of the constants passed to the function,
as well as exactly what they look like. The problem is that since our answer could be thousands
of digits long, so do our floats. Doing calculations with these large floats is computationally expensive,
but what is even more computationally expensive is calculating them in the first place.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_constants</span><span class=p>(</span><span class=n>precision</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># get precomputed exact representations of the values</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;sympy_expr.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>stored_expr</span> <span class=o>=</span> <span class=n>sp</span><span class=o>.</span><span class=n>sympify</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>term</span><span class=o>.</span><span class=n>evalf</span><span class=p>(</span><span class=n>precision</span><span class=p>)</span> <span class=k>for</span> <span class=n>term</span> <span class=ow>in</span> <span class=n>stored_expr</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>timeit</span><span class=o>.</span><span class=n>timeit</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>get_constants</span><span class=p>(</span><span class=n>digits_precision</span><span class=p>),</span> <span class=n>number</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span><span class=o>/</span><span class=mi>5</span>
</span></span></code></pre></div><table><thead><tr><th>digits precision</th><th>time</th></tr></thead><tbody><tr><td>1,000</td><td>0.09s</td></tr><tr><td>5,000</td><td>1.34s</td></tr><tr><td>10,000</td><td>4.6s</td></tr><tr><td>20,000</td><td>16s</td></tr><tr><td>100,000</td><td>5m 15s</td></tr></tbody></table><p>It takes a long time to compute these values, seemingly exhibiting a time complexity of ~\(O(n^2)\),
but surely with thousands of places of precision we should be able to calculate
solutions for massive n? Well, I found through experimentation that in order to maintain accuracy, you need roughly \(\frac{n}{3}\)
places of decimal precision to calculate the solution for n. This means that this method quickly becomes infeasible
for large n.</p><p>However, let&rsquo;s say we can precompute these values to a large precision on our supercomputer, we are then guaranteed our function will work
up to a certain n and any normal computer can compute solutions blazingly fast; it won&rsquo;t fix the fact
that our program now has a linear space complexity but as long
as it&rsquo;s fast, it&rsquo;s fine. Let&rsquo;s take a look at how our solution using the closed form solution stacks up
against the default matrix exponentiation solution:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>A</span><span class=p>,</span><span class=n>B</span><span class=p>,</span><span class=n>r1</span><span class=p>,</span><span class=n>r2</span> <span class=o>=</span> <span class=n>get_constants</span><span class=p>(</span><span class=n>n</span><span class=o>//</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recurrence_time</span> <span class=o>=</span> <span class=n>timeit</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>solve_with_recurrence</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>A</span><span class=p>,</span><span class=n>B</span><span class=p>,</span><span class=n>r1</span><span class=p>,</span><span class=n>r2</span><span class=p>),</span> <span class=n>number</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span><span class=o>/</span><span class=mi>1000</span>
</span></span><span class=line><span class=cl><span class=n>matrix_time</span> <span class=o>=</span> <span class=n>timeit</span><span class=p>(</span><span class=k>lambda</span><span class=p>:</span> <span class=n>solve_with_matrix</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=n>number</span><span class=o>=</span><span class=mi>1000</span><span class=p>)</span><span class=o>/</span><span class=mi>1000</span>
</span></span></code></pre></div><table><thead><tr><th>n</th><th>matrix time</th><th>recurrence time</th></tr></thead><tbody><tr><td>50,000</td><td>&lt;0.1ms</td><td>5ms</td></tr><tr><td>100,000</td><td>&lt;0.1ms</td><td>11ms</td></tr><tr><td>300,000</td><td>0.1ms</td><td>75ms</td></tr><tr><td>\(10^{61}\)</td><td>1ms</td><td>?</td></tr></tbody></table><p>It turns out the function, even with precomputed values, is actually much slower than the matrix exponent method
due to the precision of the floats and the size of the intermediate numbers being calculated, since we cannot
make use of any modular arithmetic tricks. In fact, due to the precision of the floats growing linearly, the
new function displays a completely different (worse) time complexity.</p><h2 class="relative group">Conclusion<div id=conclusion class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>There&rsquo;s a lot of smart engineers and mathematicians out there that can probably improve on my attempts
using the closed form solution to the recurrence and leverage its power to some extent.</p><p>However, I&rsquo;d prefer to not have to be smart. If nothing else from my little journey, please take away the fact that
you can spend a significant amount of time playing around with the maths and code to try and find a way to make your fancy
mathematical method work, all for it to be no faster than what you could have done in 10 minutes.</p><p>Sometimes it pays to try and be clever, but other times it&rsquo;s best to just use what&rsquo;s well established. Sure,
go ahead and check what the closed form solution is, but if you see irrational complex numbers, I&rsquo;d recommend
spending your time optimising another problem.</p></div></div><script>var oid="views_problems/recurrence_relations_in_programming/index.md",oid_likes="likes_problems/recurrence_relations_in_programming/index.md"</script><script type=text/javascript src=/js/page.min.b06a29d42a4ed16787978e2eee1e8c797b7698db2bc14ccee78f5c80ac566fc996190a73ad80a5e987558474b20b96fa38f7d85b405f165ff72b7b163c5ad11b.js integrity="sha512-sGop1CpO0WeHl44u7h6MeXt2mNsrwUzO549cgKxWb8mWGQpzrYCl6YdVhHSyC5b6OPfYW0BfFl/3K3sWPFrRGw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/problems/jane_street_and_numerical_integration/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Jane Street Puzzle: Beside The Point</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-01-22T00:00:00+00:00>22 January 2025</time>
</span></span></a></span><span></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2025
Barnaby Wreford</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js integrity="sha512-YgYLskf03itt3kWQNmj++2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://barnabywreford.co.uk style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>